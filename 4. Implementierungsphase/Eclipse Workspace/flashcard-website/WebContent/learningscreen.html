<html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="layout/css/layout.css">
    <link rel="stylesheet" href="layout/css/font-awesome.min.css">
    <link rel="stylesheet" href="layout/css/ui-lightness/jquery-ui-1.10.4.min.css">
    
    <script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="js/tinymce/tinymce.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.10.4.min.js"></script>
    <script type="text/javascript" src="js/jquery.knob.js"></script>
    <script type="text/javascript" src="js/getParameters.js"></script>
    <script type="text/javascript" src="js/learningscreen.js"></script>
    
    <script type="text/javascript">
        var rightAnswers = 0,
    		cardCount = 4,
    		highestId = 4;
    		
    	function initEditors(){
			tinymce.init({
			    selector: "textarea",
			    theme: "modern",
			    menubar: false,
			    statusbar: false,
			    language : 'de',
			    plugins: [
			        "advlist autolink lists link image charmap print preview hr anchor pagebreak",
			        "searchreplace wordcount visualblocks visualchars code fullscreen",
			        "insertdatetime media nonbreaking save table contextmenu directionality",
			        "emoticons template paste textcolor eqneditor"
			    ],
			    toolbar1: "undo redo | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image eqneditor",
			    image_advtab: true,
			    setup: function(ed) {
	        		ed.on('init', function(e) {
	            		e.target.hide();
	        		});
	    		},
	    		height: 145,
	    		width: 655,
	       		force_p_newlines : false,
	       		content_css : "layout/css/tinymce.css"
			});
		}

		$(document).ready(function() {
			$(document).on("click", ".edit", function(e){
				e.preventDefault();
				var element = $(this).parents().eq(1).children(".paper2");
	
				$(element).children(".redBorder").hide();
				$(element).children(".mce-container").show();
				console.log(element);
				$(this).parents().eq(1).find(".undo").removeClass("hidden");
													
				$(this).html('<i class="fa fa-save fa-2x"></i>');
				$(this).removeClass("edit");
				$(this).addClass("save");
			});
				
			$(document).on("click", ".add", function(e) {
				e.preventDefault();
				
				var container = $(this).parents().eq(2);
				console.log(container);
				highestId++;
				$(container).after('<div class="paper paper-big center paper-animate hidden" data-id="1"><div class="paper-holder"><div class="paper-buttons hidden"><a href="#" class="icon add"><i class="fa fa-plus fa-2x"></i></a><a href="#" class="icon edit"><i class="fa fa-pencil fa-2x"></i></a><a href="#" class="icon remove"><i class="fa fa-minus fa-2x"></i></a><a href="#" class="icon undo hidden"><i class="fa fa-undo fa-2x"></i></a><a href="#" class="icon wrong"><i class="fa fa-minus-circle fa-2x"></i></a><a href="#" class="icon right"><i class="fa fa-check fa-2x"></i></a></div><div class="paper2"><div class="redBorder"><figure class="front">Frage eingeben</figure><figure class="back hidden">Antwort eingeben</figure></div><textarea id="editor-f-' + highestId + '" class="paper-textarea-big">Frage eingeben</textarea><textarea id="editor-a-' + highestId + '" class="paper-textarea-big">Antwort eingeben</textarea></div></div></div>');
				
				initEditors();		
				slideRight();		
				
				//$(".activeSlide .edit").click();
				//$(".activeSlide").find(".paper-buttons").show();
			});

			$(document).on("click", ".save", function(e) {
				e.preventDefault();
				var element = $(this).parents().eq(1).children(".paper2"),
					id = $(this).parents().eq(2).attr("data-id");

				var question = $(element).find("#editor-f-" + id + "_ifr").contents().find("body").html(),
					answer = $(element).find("#editor-a-" + id + "_ifr").contents().find("body").html();

				if((!question || 0 === question.length) | (!answer || 0 === answer.length)) {
					alert("Bitte gebe eine Frage und eine Antwort ein!");
				} else {
					$(element).children(".mce-container").hide();
					$(element).children(".redBorder").show();
						
					$(element).find(".front").html(question);
					$(element).find(".back").html(answer);
					//TODO: send Ajax Request with new title (get id of database entry via data-id attribute)
					//TODO: if no id set -> add instead of edit 
						
					$(this).html('<i class="fa fa-pencil fa-2x"></i>');
					$(this).removeClass("save");
					$(this).addClass("edit");
					$(this).parents().eq(1).find(".undo").addClass("hidden");
					
					if(!$(".activeSlide .paper2").hasClass("flipped")){
						$(".activeSlide .paper-buttons").fadeOut(100);
					}
				}
			});	
			
			$(document).on("click", ".undo", function(e){
				e.preventDefault();
				cancelEdit();
				$(this).addClass("hidden");
				var saveButton = $(this).parents().eq(1).find(".save");
				$(saveButton).html('<i class="fa fa-pencil fa-2x"></i>');
				$(saveButton).removeClass("save");
				$(saveButton).addClass("edit");
				
				if(!$(".activeSlide .paper2").hasClass("flipped")){
					$(".activeSlide .paper-buttons").fadeOut(100);
				}

			});
	
			
			$(document).on("click", ".remove", function(e) {
				e.preventDefault();
				var element = $(this).parents().eq(2);
				
				if(confirm('Soll die Karteikarte wirklich gelöscht werden?')){
					if($(element).find("add") != undefined){
						$.post( "/jsp/removeFlashcardWithId.jsp", { flashcardId: $(element).attr("data-id") } , function( data ) {
							$(element).remove();
						});
					} else {
						$(element).remove();
					}
					
					$("#right-button").click();
					$(element).remove();
					
					// first or last slide deletion 
					init();
				}
			});	
		
			/* Init FlashCard Sets */
			$.getJSON("/jsp/getFlashcardsForSetWithId.jsp", {setId: $.getUrlVar("setId")}, function(data){
				console.log(data);
				$.each(data, function (index, value) {
					$("#wrapper").prepend('<div class="paper paper-big center paper-animate hidden" data-id="' + value.flashcardId + '"><div class="paper-holder"><div class="paper-buttons hidden"><a href="#" class="icon add"><i class="fa fa-plus fa-2x"></i></a><a href="#" class="icon edit"><i class="fa fa-pencil fa-2x"></i></a><a href="#" class="icon remove"><i class="fa fa-minus fa-2x"></i></a><a href="#" class="icon undo hidden"><i class="fa fa-undo fa-2x"></i></a><a href="#" class="icon wrong"><i class="fa fa-minus-circle fa-2x"></i></a><a href="#" class="icon right"><i class="fa fa-check fa-2x"></i></a></div><div class="paper2"><div class="redBorder"><figure class="front">' + value.question + '</figure><figure class="back hidden">' + value.answer + '</figure></div><textarea id="editor-f-' + value.flashcardId + '" class="paper-textarea-big">' + value.question + '</textarea><textarea id="editor-a-' + value.flashcardId + '" class="paper-textarea-big">' + value.answer + '</textarea></div></div></div>');
				});
				initEditors();
				init();
				highestId = $(".paper-big").eq(-2).attr("data-id");
			});
		});
    </script>
</head>

<body class="learning">
	<header>
		<div class="menubar">
			<div class="menubar-container">
				<ul class="menubar-nav">
					<li class="active"><a href="javaScript:void(0);">Home</a></li>
					<li><a href="javaScript:void(0);">Einstellungen</a></li>
					<li><a href="jsp/logout.jsp">Ausloggen</a></li>
				</ul>
			</div>
		</div>    
	</header>

    <a href="#" id="left-button" class="circle-button"></a>
    <a href="#" id="right-button" class="circle-button"></a>
    <div id="wrapper">
        <!--<div class="paper paper-big center paper-animate hidden" data-id="0">
        	<div class="paper-holder">
	        	<div class="paper-buttons hidden">
					<a href="#" class="icon add">
	        			<i class="fa fa-plus fa-2x"></i>
	        		</a>
					<a href="#" class="icon edit">
	        			<i class="fa fa-pencil fa-2x"></i>
	        		</a>
					<a href="#" class="icon remove">
	        			<i class="fa fa-minus fa-2x"></i>
	        		</a>
					<a href="#" class="icon undo hidden">
	        			<i class="fa fa-undo fa-2x"></i>
	        		</a>
	        		<a href="#" class="icon wrong">
	        			<i class="fa fa-minus-circle fa-2x"></i>
	        		</a>
	        		<a href="#" class="icon right">
	        			<i class="fa fa-check fa-2x"></i>
	        		</a>
	        	</div>	            
	        	<div class="paper2">
	                <div class="redBorder">
	                	<figure class="front">
		                    Was heißt 分（成）auf Deutsch?
	                    </figure>
	                    <figure class="back hidden">
	                    	einteilen (in)
	                    </figure>
	                </div>
	                <textarea id="editor-f-0" class="paper-textarea-big">Was heißt 分（成）auf Deutsch?</textarea>
	                <textarea id="editor-a-0" class="paper-textarea-big">einteilen (in)</textarea>
 	            </div>
            </div>
        </div>
        <div class="paper paper-big center paper-animate hidden" data-id="1">
        	<div class="paper-holder">
	        	<div class="paper-buttons hidden">
					<a href="#" class="icon add">
	        			<i class="fa fa-plus fa-2x"></i>
	        		</a>
					<a href="#" class="icon edit">
	        			<i class="fa fa-pencil fa-2x"></i>
	        		</a>
					<a href="#" class="icon remove">
	        			<i class="fa fa-minus fa-2x"></i>
	        		</a>
					<a href="#" class="icon undo hidden">
	        			<i class="fa fa-undo fa-2x"></i>
	        		</a>
	        		<a href="#" class="icon wrong">
	        			<i class="fa fa-minus-circle fa-2x"></i>
	        		</a>
	        		<a href="#" class="icon right">
	        			<i class="fa fa-check fa-2x"></i>
	        		</a>
	        	</div>	            
	        	<div class="paper2">
	                <div class="redBorder">
	                	<figure class="front">
		                    Was heißt 分（成）auf Deutsch?
	                    </figure>
	                    <figure class="back hidden">
	                    	einteilen (in)
	                    </figure>
	                </div>
	                <textarea id="editor-f-1" class="paper-textarea-big">Was heißt auf Deutsch?</textarea>
	               	<textarea id="editor-a-1" class="paper-textarea-big">einteilen (in)</textarea>
 	            </div>
            </div>
        </div>
        <div class="paper paper-big center paper-animate hidden">
        	<div class="paper-holder">
	        	<div class="paper-buttons hidden">
	        		<a href="#" class="icon wrong">
	        			<i class="fa fa-minus-circle fa-2x"></i>
	        		</a>
	        		<a href="#" class="icon right">
	        			<i class="fa fa-check fa-2x"></i>
	        		</a>
	        	</div>	            
	            <div class="paper2">
	                <div class="redBorder">
	                	<figure class="front">
		                	Was bedeutet 限制 auf Deutsch?
	                    </figure>
	                    <figure class="back">
	                    	jmd. einschränken
	                    </figure>
	                </div>
	            </div>
            </div>
        </div>
        <div class="paper paper-big center paper-animate hidden">
        	<div class="paper-holder">
	        	<div class="paper-buttons hidden">
	        		<a href="#" class="icon wrong">
	        			<i class="fa fa-minus-circle fa-2x"></i>
	        		</a>
	        		<a href="#" class="icon right">
	        			<i class="fa fa-check fa-2x"></i>
	        		</a>
	        	</div>	            
	            <div class="paper2">
	                <div class="redBorder">
	                	<figure class="front">
		                    Was bedeudet 惜?
	                    </figure>
	                    <figure class="back">
	                    	jmd./etw. wertschätzen
	                    </figure>
	                </div>
	            </div>
            </div>
        </div>
        <div class="paper paper-big center paper-animate hidden">
        	<div class="paper-holder">
	        	<div class="paper-buttons hidden">
	        		<a href="#" class="icon wrong">
	        			<i class="fa fa-minus-circle fa-2x"></i>
	        		</a>
	        		<a href="#" class="icon right">
	        			<i class="fa fa-check fa-2x"></i>
	        		</a>
	        	</div>	            
	            <div class="paper2">
	                <div class="redBorder">
	                	<figure class="front">
		                    Was bedeudet 气?
	                    </figure>
	                    <figure class="back">
	                    	Luft, Dampf
	                    </figure>
	                </div>
	            </div>
            </div>
        </div>-->

		<!-- Stats -->
        <div class="paper paper-big center paper-animate hidden stats">
        	<div class="paper-holder">
	            <div class="paper2">
	                <div class="redBorder">
	                	<div class="bigText centerText" style="margin-top: 10px;">5/8 Richtig</div><br/>
						<div class="centerText">
							<input class="cs_knob" value="25">
						</div>
	                </div>
	            </div>d
            </div>
        </div>
    </div>
    <a href="#" class="answerButton">Antwort zeigen</a>
</body>

</html>